<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/styles.css" />
    <title>Project Tektra</title>
  </head>
  <body>
    <!-- Loading Progress Bar -->
    <div class="loading-overlay" id="loadingOverlay">
      <div class="loading-container">
        <h2>Loading AI Model</h2>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text">
          <span id="progressStatus">Initializing...</span>
          <span id="progressPercent">0%</span>
        </div>
      </div>
    </div>

    <div id="app">
      <div class="header">
        <h1>🚀 Project Tektra</h1>
        <div class="status">
          <div class="status-dot" id="statusDot"></div>
          <span id="statusText">Initializing...</span>
        </div>
        <button id="settingsBtn" class="icon-btn">⚙️</button>
      </div>

      <div class="main-container">
        <!-- Chat Area -->
        <div class="chat-section">
          <div class="chat-messages" id="chatMessages">
            <div class="message system">
              Welcome to Project Tektra! Your local AI assistant is ready.
            </div>
          </div>
          
          <div class="chat-input-container">
            <input 
              type="text" 
              id="messageInput" 
              placeholder="Type your message..." 
              autocomplete="off"
            />
            <button id="sendBtn" class="send-btn">
              <span class="send-icon">📤</span>
            </button>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
          <div class="info-panel">
            <h3>🤖 AI Status</h3>
            <div class="model-info">
              <div class="model-name" id="modelName">Loading...</div>
              <div class="model-status" id="modelStatus">Checking connection...</div>
            </div>
            
            <button id="clearBtn" class="action-btn">🗑️ Clear Chat</button>
            <button id="refreshBtn" class="action-btn">🔄 Refresh</button>
          </div>

          <div class="voice-panel">
            <h3>🎙️ Voice Features</h3>
            <div class="voice-controls">
              <label class="toggle">
                <input type="checkbox" id="voiceEnabled">
                <span class="slider"></span>
                Always Listening
              </label>
              
              <label class="toggle">
                <input type="checkbox" id="autoSpeech">
                <span class="slider"></span>
                Auto Speech
              </label>
            </div>
            
            <div class="voice-indicator hidden" id="voiceIndicator">
              <div class="wave-animation">
                <div class="wave"></div>
                <div class="wave"></div>
                <div class="wave"></div>
              </div>
              <span>Listening...</span>
            </div>
          </div>

          <!-- Camera Panel -->
          <div class="camera-panel">
            <h3>📷 Vision Input</h3>
            <div class="camera-controls">
              <button id="cameraToggleBtn" class="action-btn">Enable Camera</button>
              <div id="cameraPreview" class="camera-preview hidden">
                <canvas id="cameraCanvas" width="320" height="240"></canvas>
              </div>
            </div>
          </div>

          <!-- Avatar Panel -->
          <div class="avatar-panel">
            <h3>🤖 Tektra Avatar</h3>
            <div class="avatar-container">
              <canvas id="avatarCanvas" width="300" height="300"></canvas>
            </div>
            <div class="avatar-controls">
              <select id="avatarExpression" class="expression-select">
                <option value="neutral">Neutral</option>
                <option value="happy">Happy</option>
                <option value="thinking">Thinking</option>
                <option value="surprised">Surprised</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Modal -->
      <div id="settingsModal" class="modal hidden">
        <div class="modal-content">
          <div class="modal-header">
            <h2>⚙️ Settings</h2>
            <button id="closeSettings" class="close-btn">✕</button>
          </div>
          
          <div class="modal-body">
            <div class="setting-group">
              <label for="ollamaModel">AI Model:</label>
              <select id="ollamaModel">
                <option value="Built-in Assistant">Built-in Assistant</option>
                <option value="Local Pattern Matcher">Local Pattern Matcher</option>
              </select>
            </div>
            
            <div class="setting-group" style="display: none;">
              <label for="ollamaUrl">Model URL (Embedded):</label>
              <input type="text" id="ollamaUrl" value="embedded" readonly />
            </div>
            
            <div class="setting-group">
              <label class="toggle">
                <input type="checkbox" id="settingsVoiceEnabled">
                <span class="slider"></span>
                Enable Voice Features
              </label>
            </div>
            
            <h3 style="margin-top: 1.5rem;">Advanced Settings</h3>
            
            <div class="setting-group">
              <label for="systemPrompt">System Prompt:</label>
              <textarea id="systemPrompt" rows="4" style="width: 100%; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px; font-family: monospace; font-size: 0.9rem;">You are Tektra, a helpful AI assistant powered by the Gemma-3n model. You provide accurate, thoughtful, and detailed responses.</textarea>
            </div>
            
            <div class="setting-group">
              <label for="userPrefix">User Message Prefix:</label>
              <input type="text" id="userPrefix" value="User: " />
            </div>
            
            <div class="setting-group">
              <label for="assistantPrefix">Assistant Message Prefix:</label>
              <input type="text" id="assistantPrefix" value="Assistant: " />
            </div>
          </div>
          
          <div class="modal-footer">
            <button id="saveSettings" class="save-btn">💾 Save Settings</button>
          </div>
        </div>
      </div>
    </div>

    <script type="module" src="/main.js"></script>
  </body>
</html>